# Redis
1. 是什么

内存数据库，直接将数据保存在内存中，还可以定期将数据持久化到硬盘中。

2. 优点

- 内存操作，新能好。
- 支持多数据结构，value最大1GB容量。
- 多数据结构使redis可做多应用。
- 可为k-v设置过期时间。

3. 缺点

大小受物理内存影响，不适合高数据量读写。

# 与Memcached比较

共同点：
- 都是内存数据库
- 都有过期策略
- 性能都很高

不同点：
- Redis支持多数据结构，Memcached只支持字符串。
- Redis有灾难恢复机制。
- 内存使用完Redis将不常用数据持久化到硬盘，memcached直接报错。
- Redis支持原生集群，Memcached不支持。
- Redis采用单线程和IO多路复用，Memcached是多线程和非阻塞IO。
- Redis支持订阅发布、事务和Lua脚本。
- 定期数据删除，Redis是定期和惰性删除，Memcached是惰性删除。
- Redis性能比Memcached高。
- Redis可以持久化数据。


# Redis支持的数据类型
String、List、Set、Sorted Set、Hashes

# Redis适合场景
1. 会话缓存
2. 全页缓存
3. 队列
4. 排行榜、计数器
5. 发布订阅

# Redisson
是基于Redis的高级分布式框架。

# Redis数据淘汰策略
1. 返回错误当内存到达界限
2. 淘汰不常用key，为新增内容腾出空间
3. 淘汰不常用key，仅在过期key中查找
4. 随机淘汰不常用key
5. 随机淘汰不常用key，仅在过期key中查找

# Redis除缓冲其他作用
1. 分布式锁
2. 限流
3. 消息队列
4. 分布式token

# Redis消息队列
Redis5.0新增Stream数据类型。
- 发布/订阅模式
- 按照消费者组进行消费
- 消息持久化

# String和Hash哪个储存较好
- String是储存序列化后的对象数据，存放的是整个对象。Hash是存放对象的字段，对与经常修改字段或者新增字段存在Hash中较好。
- String储存数据较Hash占用空间较少，性能较高。如果对性能较敏感应用建议使用String。

# 实现随机抽检
使用SET集合：
- `SPOP key count`：随机移除并获取指定集合中一个或多个元素，适合不允许重复中奖的场景。
- `SRANDMEMBER key count`：随机获取指定集合中指定数量的元素，适合允许重复中奖的场景。

# Bitmap实现用户活跃度
可以使用日期当成key，使用用户的ID当成偏移量，对用户活跃状态进行设置。

1. 使用用户的ID当做偏移量，进行设置。
```shell
SETBIT 20221001 10001 1;
SETBIT 20221001 10002 1;
SETBIT 20221002 10001 1;
```
2. 统计两天同时活跃用户。
```shell
# 计算结果
BITOP and desk1 20221001 20221002;
# 统计结果
BITCOUNT desk1;
```
3. 统计两天在线过的用户。
```shell
BITOP or desk2 20221001 20221002;
BITCOUNT desk1;
```

# Redis6.0之前为什么不多线程
在Redis4.0就增加了多线程，只不过是针对大键值对的操作，一些删除，清理数据区的异步操作。

- 单线程编程容易维护也容易
- Redis瓶颈不在CPU而在于内存和网络
- 多线程可能会出现死锁和上下文切换问题，这样会消耗一些性能

# Redis6.0之后为什么使用多线程
Redis6.0 引入多线程主要是为了提高网络 IO 读写性能。虽然，Redis6.0 引入了多线程，但是 Redis 的多线程只是在网络数据的读写这类耗时操作上使用了，
执行命令仍然是单线程顺序执行。因此，你也不需要担心线程安全问题。

- 默认多线程关闭
- `io-threads-do-reads yes`配置文件开启
- 开启后需要配置线程数：io-threads 4 #官网建议4核的机器建议设置为2或3个线程，8核的建议设置为6个线程






